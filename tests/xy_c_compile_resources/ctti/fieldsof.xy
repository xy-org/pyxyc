import xy.ctti;

struct MyStruct {
    a: Int,
    b: Float,
    c: SubStruct,
}

struct SubStruct {
    d: Ptr~MyStruct,
}

struct FieldDesc {
    size: Usize,
}

func print(d: FieldDesc) {
    # omitted for brevity
}

func printFields(
    s: pseudo Any,
    fields: pseudo @FieldDesc[] = @for (f in s'fieldsof) FieldDesc{
        size=sizeof(f)
    },
    fieldsPtr : Ptr~FieldDesc = fields'addrof,
    fieldsLen : Usize = fields'len,
) -> void {
    for (i in :fieldsLen) {
        print(fieldsPtr[i]);
    }
}

func test1() {
    s := MyStruct{};
    descs := @for (f in s'fieldsof) FieldDesc{f'sizeof};
}

func test2() {
    s := MyStruct{};
    for (desc in @for (f in s'fieldsof) FieldDesc{f'sizeof}) {
        # ...
    }
}

func test3() {
    s := MyStruct{};
    printFields(s);
}