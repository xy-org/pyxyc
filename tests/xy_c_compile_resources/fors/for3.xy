;; An array of up to 100 floats
struct Array {
    elems: @Float[100];
    len: Usize;
}

func iter(arr: pseudo Array) -> arr[ Usize ] {
    return 0;
}

func valid(arr: Array, idx: Usize) = idx < arr.len;

func next(arr: pseudo Array, idx: mut Usize) {
    idx++;
}

func get(arr: Array, idx: Usize) -> arr[ Ptr~Float ]
>> valid(arr, idx)
{
    return arr.elems[idx]'addrof;
}

func set(arr: mut Array, idx: Usize, elem: Float)
# >> valid(arr, idx)
{
    arr.elems[idx] = elem;
}

func sum(arr: Array) -> Float {
    return for(elem in arr) -> (res: Float) {
        res += elem;
    };
}

func mix(arr1: Array, arr2: Array) -> Float
>> arr1'len == arr2'len
{
    return for(i in :, e1 in arr1, e2 in arr2) -> (res: Float) {
        res += i'to(Float) * e1 * e2;
    };
}

func double(arr1: mut Array) {
    for(elem in arr1) {
        if (elem > 0) {
            elem = 2.0f * elem;
            elem += elem;
        }
    }
}

func doSomething(f: Float) {
}

func changeSomehow(f: mut Float) {
}

func iterAndChange(arr1: mut Array) {
    for(elem in arr1) {
        doSomething(elem);
        changeSomehow(elem);
    }
}
