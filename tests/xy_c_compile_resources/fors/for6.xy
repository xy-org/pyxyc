struct Str {
    mem: Ptr~Char;
}

func dtor(s: Str) {
    # ...
}

func get(s: Str, i: Int) -> Str {
    return Str{s.mem + i};
}

struct CharIter {
    i: Usize;
    char: Char;
}

*func chars~IterCtor(str: Str) -> str[ CharIter ] {
    iter : CharIter;
    next(str, iter);
    return iter;
}

*func get(str: Str, charIter: CharIter) = charIter.char;

*func valid(str: Str, iter: CharIter) iter.char'to(Int) >= 0;

*func next(str: Str, iter: mut CharIter) {
    iter.i++;
}

func test() {
    s := Str{};
    for (char in s[1]'chars) {
        doSomething(char);
    }
}

func doSomething(char: Char) {
    # ...
}
